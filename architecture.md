# Software Architecture v1.3

## 다이내믹 컨트롤 패널 기반 실시간 인용 관리 시스템

---

## 1. 아키텍처 개요 (High-Level Architecture)

본 시스템은 **Google Apps Script(GAS)**를 기반으로 하며, 사이드바 상단의 **다이내믹 컨트롤 패널**이 **상태 엔진(State Engine)** 역할을 수행하여 사용자의 작업 맥락(인용 삽입, 더미 감지, 대조 오류 등)에 따라 UI와 기능을 유연하게 전환합니다.

---

## 2. 계층별 상세 설계 (Layered Design)

### 2.1 UI 계층: 컨텍스트 인식 사이드바 (Context-Aware Sidebar)

#### 다이내믹 컨트롤 패널 (상단 고정 영역)

본문 커서 위치나 사이드바 선택 상태에 따라 실시간으로 변하는 제어부입니다.

- **인용 삽입 모드**  
  사이드바에서 논문 선택 시 활성화되며, `저자(연도)`, `(저자, 연도)`, `저자만` 등의 옵션을 버튼 형태로 제시합니다.

- **더미 매핑 모드**  
  본문에서 더미 인용(`[Kim:2023]`) 감지 시 활성화되며, 실제 참조 문헌과의 연결 버튼을 제공합니다.

#### 참조 문헌 풀 (중단 영역)

사용자가 복붙한 논문 리스트가 표시되며, **더미 인용**과 연결된 상태를 시각적으로 구분합니다.

---

### 2.2 서비스 로직 계층: 상태 및 데이터 관리

| 구성 요소 | 설명 |
|----------|------|
| **상태 엔진 (State Manager)** | 구글 닥스의 선택 영역(Selection)이나 커서 위치를 주기적으로 모니터링하여 컨트롤 패널의 모드를 전환합니다. |
| **인용 스타일 변환 엔진** | Citation.js를 활용하여 선택된 삽입 모드에 맞춰 즉석에서 서식을 생성합니다. |
| **지능형 매핑 엔진 (Dummy-Ref Mapper)** | Fuse.js를 사용하여 사용자가 입력한 더미 키워드와 플레이스홀더 내 논문들 간의 유사도를 계산하고 최적의 매칭을 제안합니다. |

---

## 3. 핵심 데이터 흐름 (Key Data Flow)

### 3.1 인용 삽입 흐름

1. 사용자가 사이드바 리스트에서 **논문 A** 선택.
2. 다이내믹 컨트롤 패널이 즉시 **인용 삽입 모드**로 전환되어 서식 옵션 노출.
3. 사용자가 옵션 클릭 → **DocumentApp API**를 통해 본문 커서 위치에 스타일링된 텍스트 삽입.

### 3.2 더미-참조 연결 및 업데이트 흐름

1. 사용자가 목록에 없는 더미(`[Kim:2023]`)를 본문에 입력.
2. 시스템이 본문을 스캔하여 다이내믹 컨트롤 패널에 **"연결되지 않은 더미 인용 발견"** 알림 표시.
3. 사용자가 실제 논문 데이터 추가 후 패널에서 **연결** 클릭 → 문서 내 모든 동일 더미가 정식 서식으로 일괄 전환.

---

## 4. 환경 및 라이브러리 구성 (Stack & Libraries)

| 구분 | 항목 | 용도 및 특징 |
|------|------|--------------|
| **개발 환경** | VS Code + clasp | 로컬 개발 및 구글 서버와의 안정적인 코드 동기화. |
| **운영 환경** | GAS V8 + OAuth 2.0 | 구글 워크스페이스 내 안전한 실행 및 문서 접근 권한 관리. |
| **UI 라이브러리** | Vue.js / React | 패널의 동적인 상태 변화를 매끄럽게 처리하기 위한 리액티브 프레임워크. |
| **핵심 로직** | Citation.js | 글로벌 학술 표준 스타일(APA 등)의 실시간 생성 및 검증. |
| **검색 로직** | Fuse.js | 더미 인용과 참조 문헌 간의 지능형 매칭을 위한 퍼지 검색 엔진. |

---

## 5. 비기능적 요구사항 (Non-functional Requirements)

- **사용자 경험**  
  본문 위를 가리는 팝업 대신, 익숙한 사이드바 패널 내에서 모든 조작이 완료되도록 하여 **작업 흐름의 단절**을 원천 봉쇄합니다.

- **다국어 안정성**  
  한국어 조사 처리 및 유니코드 정규화를 통해 한중일 연구자들의 문서 무결성을 보장합니다.

- **확장성**  
  컨트롤 패널 기반 UI 구조는 추후 **AI 문장 추천**이나 **표절 검사** 기능 추가 시에도 레이아웃 변경 없이 모드만 추가하여 대응 가능합니다.

---

> 이 아키텍처는 구글 닥스의 표준 인터페이스 가이드라인을 준수하면서도, 전문적인 논문 작성에 필요한 고도의 인터랙션을 안정적으로 지원합니다.
